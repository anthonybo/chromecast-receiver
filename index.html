<!DOCTYPE html>
<html>
<head>
  <title>Custom Chromecast Receiver</title>
  <script type="text/javascript" src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
  <style>
    #logs {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black */
      color: white;
      font-size: 16px;
      padding: 10px;
      white-space: pre-wrap;
      z-index: 1000; /* Ensure it's on top */
      max-height: 50%; /* Limit the height */
      overflow-y: auto; /* Add scroll if content is too long */
    }
  </style>
</head>
<body>

<audio id="audio" controls></audio>
<div id="logs"></div>

<script>
  function log(message) {
    console.log(message); // Log to console as well
    const logsElement = document.getElementById('logs');
    logsElement.textContent += message + '\n'; // Add message to screen
  }

  const context = cast.framework.CastReceiverContext.getInstance();

  // Example MIME type and codec for checking; adjust as necessary for your media
  const mimeType = 'audio/mp4';
  const codecs = 'mp4a.40.5';
  const isSupported = context.canDisplayType(mimeType, codecs);
  log(`Checking support for MIME type '${mimeType}' with codecs '${codecs}': ${isSupported}`);

  const playerManager = context.getPlayerManager();

  playerManager.setMessageInterceptor(
    cast.framework.messages.MessageType.LOAD,
    (request) => {
      log(`Received LOAD request for media: ${request.media.contentId}`);
      
      if (!isSupported) {
        log('Media type is not supported. Rejecting LOAD request.');
        return Promise.reject(new cast.framework.messages.ErrorData(cast.framework.messages.ErrorType.LOAD_FAILED));
      }

      log('Proceeding to load and play the supported media.');
      const audioElement = document.getElementById('audio');
      audioElement.src = request.media.contentId;
      audioElement.load();
      audioElement.play().then(() => {
        log('Audio playback started successfully.');
      }).catch((error) => {
        log(`Error during audio playback: ${error.message}`);
      });

      // Return unchanged request for processing
      return request;
    });

  playerManager.addEventListener(
    cast.framework.events.EventType.ERROR,
    (event) => {
      log(`Error event received: ${JSON.stringify(event)}`);
    });

  context.start();
  log('Custom Chromecast Receiver started.');
</script>

</body>
</html>
