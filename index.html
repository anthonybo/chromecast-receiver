<!DOCTYPE html>
<html>
<head>
  <title>Custom Chromecast Receiver</title>
  <script type="text/javascript" src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
  <style>
    #logs {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black */
      color: white;
      font-size: 16px;
      padding: 10px;
      white-space: pre-wrap;
      z-index: 1000; /* Ensure it's on top */
      max-height: 50%; /* Limit the height */
      overflow-y: auto; /* Add scroll if content is too long */
    }
  </style>
</head>
<body>

<audio id="audio" controls></audio>
<div id="logs"></div>

<script>
  function log(message) {
    console.log(message); // Also log to console
    const logsElement = document.getElementById('logs');
    logsElement.textContent += message + '\n'; // Display message on screen
  }

  const context = cast.framework.CastReceiverContext.getInstance();
  const playerManager = context.getPlayerManager();

  playerManager.setMessageInterceptor(
    cast.framework.messages.MessageType.LOAD,
    (request) => {
      const mimeType = request.media.contentType; // Dynamically get MIME type from request
      // Assuming the codecs are part of the mimeType; if separate, they need to be extracted differently
      const isSupported = context.canDisplayType(mimeType);
      log(`Received LOAD request for media: ${request.media.contentId}`);
      log(`Checking support for MIME type '${mimeType}': ${isSupported}`);

      if (!isSupported) {
        log('Media type is not supported. Rejecting LOAD request.');
        return Promise.reject(new cast.framework.messages.ErrorData(cast.framework.messages.ErrorType.LOAD_FAILED));
      }

      log('Proceeding to load and play the supported media.');
      const audioElement = document.getElementById('audio');
      audioElement.src = request.media.contentId;
      audioElement.load();
      audioElement.play().then(() => {
        log('Audio playback started successfully.');
      }).catch((error) => {
        log(`Error during audio playback: ${error.message}`);
      });

      return request; // Proceed with loading the requested media
    });

  playerManager.addEventListener(
    cast.framework.events.EventType.ERROR,
    (event) => {
      log(`Error event received: ${JSON.stringify(event)}`);
    });

  context.start();
  log('Custom Chromecast Receiver started. Custom media check added.');
</script>

</body>
</html>
