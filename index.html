<!DOCTYPE html>
<html>
<head>
  <title>Custom Chromecast Receiver</title>
  <script type="text/javascript" src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
  <style>
    #logs {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black */
      color: white;
      font-size: 16px;
      padding: 10px;
      white-space: pre-wrap;
      z-index: 1000; /* Ensure it's on top */
      max-height: 50%; /* Limit the height */
      overflow-y: auto; /* Add scroll if content is too long */
    }
  </style>
</head>
<body>

<div id="logs"></div>

<script>
  function log(message) {
    console.log(message); // Also log to console
    const logsElement = document.getElementById('logs');
    logsElement.textContent += message + '\n'; // Add message to screen
  }

  const context = cast.framework.CastReceiverContext.getInstance();
  const playerManager = context.getPlayerManager();

  // Customizing media requests
  playerManager.setMediaPlaybackInfoHandler((loadRequest, playbackConfig) => {
      // Example: Setting the HTTP referer and origin headers for media requests
      playbackConfig.headers = playbackConfig.headers || {};
      playbackConfig.headers['Referer'] = 'https://www.dev.sdliveone.com/';
      playbackConfig.headers['Origin'] = 'https://www.dev.sdliveone.com';
      
      // Note: Not all headers can or should be set this way. For example, User-Agent is controlled by the browser/device.
      
      return playbackConfig;
  });

  playerManager.setMessageInterceptor(
    cast.framework.messages.MessageType.LOAD,
    loadRequestData => {
      log(`Received LOAD request for media: ${loadRequestData.media.contentId}`);
      log(`MIME type: ${loadRequestData.media.contentType}`);

      // Dynamically check if the MIME type is 'application/x-mpegURL' for HLS streams
      if (loadRequestData.media.contentType === 'application/x-mpegURL') {
        log('MIME type is for HLS stream. Setting HlsSegmentFormat to AAC.');
        loadRequestData.media.hlsSegmentFormat = cast.framework.messages.HlsSegmentFormat.AAC;
      } else {
        log('MIME type is not for HLS stream. Proceeding without setting HlsSegmentFormat.');
      }

      // This log is to confirm the change or non-change based on MIME type
      log(`HlsSegmentFormat set to: ${loadRequestData.media.hlsSegmentFormat}`);

      return loadRequestData;
    });

  // Example of adding more detailed logging for the error events
  playerManager.addEventListener(
    cast.framework.events.EventType.ERROR,
    error => log(`Error event received: ${JSON.stringify(error)}`)
  );

  context.start();
  log('Custom Chromecast Receiver started. hlsSegmentFormat, network header test');
</script>

</body>
</html>
